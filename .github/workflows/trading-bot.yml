name: Trading Bot - Analyse horaire

on:
  schedule:
    # ExÃ©cution toutes les heures (Ã  la minute 5)
    - cron: '*/5 * * * *'

  # Permet aussi le dÃ©clenchement manuel
  workflow_dispatch:

jobs:
  analyze:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout du code
        uses: actions/checkout@v4

      - name: ğŸ Configuration Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ğŸ“¦ Installation des dÃ©pendances
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # RÃ©cupÃ©ration de l'Ã©tat prÃ©cÃ©dent (s'il existe)
      - name: ğŸ“‚ TÃ©lÃ©chargement de l'Ã©tat prÃ©cÃ©dent
        uses: actions/cache@v4
        with:
          path: state.json
          key: bot-state-${{ github.run_id }}
          restore-keys: |
            bot-state-

      - name: ğŸ¤– ExÃ©cution du bot
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          DISCORD_HEARTBEAT_WEBHOOK_URL: ${{ secrets.DISCORD_HEARTBEAT_WEBHOOK_URL }}
          SYMBOL: 'BTC/USDT'
          TIMEFRAME: '5m'
          SEND_HEARTBEAT: 'true'
        run: |
          echo "ğŸš€ DÃ©marrage de l'analyse..."
          python main.py
          echo "âœ… Analyse terminÃ©e"

      # Sauvegarde du nouvel Ã©tat
      - name: ğŸ’¾ Sauvegarde de l'Ã©tat
        uses: actions/cache/save@v4
        if: always()
        with:
          path: state.json
          key: bot-state-${{ github.run_id }}